# 接口

## 1. 概念

由于go是强类型语言，所以需要有接口用于抽象及解耦。

## 2. 示例
下面我们一步步引入接口的概念：

1. 假设我们现在抓取一个页面的内容
```go
package main 

import (
  "fmt"
  "io/ioutil"
  "net/http"
)

func main() {
  // 抓取一个页面
  resp, _ := http.Get("https://www.baidu.com")

  // 当页面请求完成时，关闭连接
  defer resp.Body.Close()

  // 读取内容
  bytes, _ := ioutil.ReadAll(resp.Body)

  fmt.Printf("%s\n", bytes)
}
```

2. 我们来把main函数里的内容抽象成一个函数

```go
package main 

import (
  "fmt"
  "io/ioutil"
  "net/http"
)

func retrieve(url string) string {
  resp, _ := http.Get(url)
  defer resp.Body.Close()
  bytes, _ := ioutil.ReadAll(resp.Body)
  return string(bytes)
}

func main() {
  fmt.Println(retrieve("https://www.baidu.com"))
}
```

3. 上述 main 函数还是依赖 retrieve 函数，而这个 retrieve 可以由多个来源，假设我们项目中 infra 中实现了一个 retriever 结构体。

```go
package infra 

type Retriever struct {}

// 定义结构体方法
func (Retriever) Get(url string) string {
  resp, _ := http.Get(url)
  defer resp.Body.Close()
  bytes, _ := ioutil.ReadAll(resp.Body)
  return string(bytes)
}
```


```go
package main 

import (
  "fmt"
  "go-learning/infra"
)

func getRetriever() infra.Retriever {
  return infra.Retriever{}
}

func main() {
  var retriever infra.Retriever = getRetriever()
  fmt.Println(retriever.Get("https://www.baidu.com"))
}
```

4. 那现在我们的函数还是依赖 infra 中的 retriever, 假设我们需要改成其他结构体的Retriever，就会让我们将所有infra.retriever改成其他，改动非常大。所以我们需要引入接口，来增强我们代码的健壮性。

```go
package main 

import (
  "fmt"
  "go-learning/infra"
)

type retriever interface {
  Get(string) string
}

func getRetriever() retriever {
  // 假如我们修改了其他结构体，那么我们无需把所有推断都改一遍了
  return testing.Retriever{}
}

func main() {
  var retriever retriever = getRetriever()
  fmt.Println(retriever.Get("https://www.baidu.com"))
}
```
